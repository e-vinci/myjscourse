{"version":3,"sources":["webpack://myjscourse/./src/components/auths/login/login.js","webpack://myjscourse/./src/utils/api/fetch.js","webpack://myjscourse/./src/components/auths/project/project-page.js","webpack://myjscourse/./src/components/auths/login/logintemp.js","webpack://myjscourse/./src/components/auths/login/logout.js","webpack://myjscourse/./src/components/auths/route/secured-route.js","webpack://myjscourse/./src/pages/app.js"],"names":["useState","isSigned","setIsSigned","useEffect","onSigningIn","signIn","isSignedIn","navigate","Link","to","S","src","alt","width","height","callAPI","endpoint","method","token","data","headers","Headers","options","bearer","append","body","JSON","stringify","toLowerCase","url","process","fetch","response","ok","fullErrorMessage","status","statusText","text","textResponse","console","error","search","onTokenExpiration","Error","json","acquireTokenSilent","success","undefined","projectGroup","setProjectGroup","getData","tempProjectGroup","href","signOut","Component","component","location","rest","window","getUserName","pathname","Router","basepath","path","Logout","ProjectPage"],"mappings":"wuCA4CA,EAtCc,WAAO,IAAD,GACcA,eAAS,GAAlCC,EADW,KACDC,EADC,MAGlBC,gBAAU,WAEHF,GAAUG,OAIjB,IAAMA,EAAW,mCAAG,qGACOC,UADP,OACZC,EADY,OAElBJ,EAAYI,GAFM,2CAAH,qDAKjB,OAAIL,IACFM,cAAS,qBACF,MAIP,2BACE,+DAEE,gBAAC,EAAAC,KAAD,CAAMC,GAAG,cACP,gBAAC,EAAAC,EAAD,CACEC,IAAI,iCACJC,IAAI,GACJC,MAAM,KACNC,OAAO,KAJT,qBADF,OAFF,sBCvBS,SAAeC,EAA9B,wC,wCAAe,WAAuBC,EAAUC,EAAgBC,EAAOC,GAAxD,mGAAiCF,MAAS,OACnDG,EAAU,IAAIC,SACdC,EAAU,IACNL,OAASA,EAEbC,IACIK,EADG,UACgBL,EACzBE,EAAQI,OAAO,gBAAiBD,IAG9BJ,IACFG,EAAQG,KAAOC,KAAKC,UAAUR,IAIL,SAAzBF,EAAOW,eACkB,UAAzBX,EAAOW,eACkB,QAAzBX,EAAOW,eAEPR,EAAQI,OAAO,eAAgB,oBACjCF,EAAQF,QAAUA,EACZS,EAAMC,4CAA6Bd,EArB5B,mBA8BYe,MAAMF,EAAKP,GA9BvB,YA8BLU,EA9BK,QAgCGC,GAhCH,wBAiCLC,EACF,iBACAF,EAASG,OACT,MACAH,EAASI,WACT,eAtCO,UAuCkBJ,EAASK,OAvC3B,WAuCHC,EAvCG,OAwCTJ,GAAoBI,EACpBC,QAAQC,MAAM,gBAAiBN,KAE3BA,EAAiBO,OAAO,YAAc,GA3CjC,kCA6CMC,IA7CN,uDA+CH,IAAIC,MAAMT,GA/CP,yBAiDEF,EAASY,OAjDX,iJ,sBAwDf,IAAMF,EAAiB,mCAAG,8GAEAG,UAFA,cAEhBC,EAFgB,yBAGfA,GAHe,oGAAH,qDC5BvB,EA7BoB,WAAO,IAAD,GACgB9C,mBAAS+C,GAA1CC,EADiB,KACHC,EADG,MAGxB9C,gBAAU,WAER+C,MACC,IAEH,IAAMA,EAAO,mCAAG,6GAEiBnC,EAC3B,+BACA,OAJU,OAERoC,EAFQ,OAMZF,EAAgBE,GANJ,gDASZZ,QAAQC,MAAM,gBAAd,MATY,yDAAH,qDAab,OACE,2BACE,0CACA,8CAAsBd,KAAKC,UAAUqB,MCH3C,EApBkB,WAChB,OACE,2BACE,+DAEE,gBAAC,EAAAxC,KAAD,CAAM4C,KAAK,IAAI3C,GAAG,gBAChB,gBAAC,EAAAC,EAAD,CACEC,IAAI,iCACJC,IAAI,GACJC,MAAM,KACNC,OAAO,KAJT,qBADF,OAFF,sBCMN,EATe,WAMb,OAJAuC,WAGA9C,cAAS,KACF,qC,UCIT,EAVqB,SAAC,GAAiD,IAApC+C,EAAmC,EAA9CC,UAAsBC,EAAwB,EAAxBA,SAAaC,GAAW,mCAEpE,MAAsB,oBAAXC,OAA+B,MAErCC,WAAiB,iBAAAH,EAASI,SAIxB,gBAACN,EAAcG,KAHpBlD,cAAS,gBACF,OCUX,EAXY,kBACV,gBAAC,IAAD,KACE,gBAAC,EAAAsD,OAAD,CAAQC,SAAS,QACf,gBAAC,EAAD,CAAOC,KAAK,WACZ,gBAAC,EAAD,CAAWA,KAAK,eAEhB,gBAAC,EAAD,CAAcA,KAAK,UAAUR,UAAWS,IACxC,gBAAC,EAAD,CAAcD,KAAK,gBAAgBR,UAAWU","file":"component---src-pages-app-js-1cbec0ee654c9216d2b0.js","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { signIn } from \"../../../utils/auths/authPopup.js\";\r\nimport { navigate } from \"gatsby\";\r\nimport { Link } from \"gatsby\";\r\nimport { StaticImage } from \"gatsby-plugin-image\";\r\n\r\nconst Login = () => {\r\n  const [isSigned, setIsSigned] = useState(false);\r\n\r\n  useEffect(() => {\r\n    // You need to restrict it at some point\r\n    if (!isSigned) onSigningIn();\r\n  });\r\n\r\n  // call the popup function from MS Azure AD\r\n  const onSigningIn = async () => {\r\n    const isSignedIn = await signIn();\r\n    setIsSigned(isSignedIn);\r\n  };\r\n\r\n  if (isSigned) {\r\n    navigate(\"/app/project-page\");\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <p>\r\n        Vous pouvez vous logger en cliquant\r\n        <Link to=\"/app/login\">\r\n          <StaticImage\r\n            src=\"../../../images/logo_vinci.png\"\r\n            alt=\"\"\r\n            width=\"24\"\r\n            height=\"24\"\r\n          />\r\n          ici\r\n        </Link>\r\n        ou dans le menu.\r\n      </p>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Login;\r\n","// Helper function to call our API\r\n// using authorization bearer token scheme\r\nimport { acquireTokenSilent } from \"../auths/authPopup\";\r\n\r\nexport default async function callAPI(endpoint, method = \"get\", token, data) {\r\n  let headers = new Headers();\r\n  let options = {};\r\n  options.method = method;\r\n\r\n  if (token) {\r\n    const bearer = `Bearer ${token}`;\r\n    headers.append(\"Authorization\", bearer);\r\n  }\r\n\r\n  if (data) {\r\n    options.body = JSON.stringify(data);\r\n  }\r\n\r\n  if (\r\n    method.toLowerCase() === \"post\" ||\r\n    method.toLowerCase() === \"patch\" ||\r\n    method.toLowerCase() === \"put\"\r\n  )\r\n    headers.append(\"Content-Type\", \"application/json\");\r\n  options.headers = headers;  \r\n  const url = process.env.GATSBY_API_URL + endpoint;\r\n  console.log(\r\n    \"request made to API at: \" + new Date().toString(),\r\n    \"URL:\",\r\n    url,\r\n    \"Options:\",\r\n    options\r\n  );\r\n  try {\r\n    const response = await fetch(url, options);\r\n\r\n    if (!response.ok) {\r\n      let fullErrorMessage =\r\n        \" Error code : \" +\r\n        response.status +\r\n        \" : \" +\r\n        response.statusText +\r\n        \"/nMessage : \";\r\n      const textResponse = await response.text();\r\n      fullErrorMessage += textResponse;\r\n      console.error(\"fetch() error\", fullErrorMessage);\r\n      // deal with token expiration\r\n      if (fullErrorMessage.search(\"expired\") > -1) {\r\n        console.log(\"issue\");\r\n        return await onTokenExpiration();\r\n      }\r\n      throw new Error(fullErrorMessage);\r\n    }\r\n    return await response.json();\r\n  } catch (error) {\r\n    console.log(\"error:\", error);\r\n    throw error;\r\n  }\r\n}\r\n\r\nconst onTokenExpiration = async () => {\r\n  try {\r\n    const success = await acquireTokenSilent();\r\n    return success;\r\n  } catch (error) {\r\n    console.log(\"onTokenExpiration:error:\", error);\r\n    throw error;\r\n  }\r\n};\r\n","import React, { useEffect, useState } from \"react\";\r\nimport callAPI from \"../../../utils/api/fetch\";\r\n\r\nconst ProjectPage = () => {\r\n  const [projectGroup, setProjectGroup] = useState(undefined);\r\n\r\n  useEffect(() => {\r\n    // get data from APIs\r\n    getData();\r\n  }, []);\r\n\r\n  const getData = async () => {\r\n    try {\r\n      let tempProjectGroup = await callAPI(\r\n        \"projectgroups/default/public\",\r\n        \"get\"\r\n      );\r\n      setProjectGroup(tempProjectGroup);\r\n      console.log(\"data:\", tempProjectGroup);\r\n    } catch (error) {\r\n      console.error(\"getData:error\", error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <h3>Project Page</h3>\r\n      <p>Current project : {JSON.stringify(projectGroup)}</p>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ProjectPage;\r\n","import React from \"react\";\r\nimport { StaticImage } from \"gatsby-plugin-image\";\r\nimport { Link } from \"gatsby\";\r\n\r\nconst LoginTemp = () => {\r\n  return (\r\n    <div>\r\n      <p>\r\n        Vous pouvez vous logger en cliquant\r\n        <Link href=\"#\" to=\"/auths/login\">\r\n          <StaticImage\r\n            src=\"../../../images/logo_vinci.png\"\r\n            alt=\"\"\r\n            width=\"24\"\r\n            height=\"24\"\r\n          />\r\n          ici\r\n        </Link>\r\n        ou dans le menu.\r\n      </p>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default LoginTemp;\r\n","import React from \"react\";\r\nimport { signOut } from \"../../../utils/auths/authPopup.js\";\r\nimport { navigate } from \"gatsby\";\r\n\r\nconst Logout = () => {\r\n  // call the popup function from MS Azure AD\r\n  signOut();   \r\n  //sessionStorage.clear();\r\n  // force to rerender all the components => navigate to home\r\n  navigate(\"/\");\r\n  return <h3>Logout</h3>\r\n};\r\n\r\nexport default Logout;\r\n","import React from \"react\";\r\nimport { navigate } from \"gatsby\";\r\nimport { getUserName } from \"../../../utils/auths/authPopup.js\";\r\n\r\nconst PrivateRoute = ({ component: Component, location, ...rest }) => {\r\n  // don't do anything if this is run at server side (no window object)\r\n  if (typeof window === \"undefined\") return null;\r\n\r\n  if (!getUserName() && location.pathname !== `/auths/login`) {\r\n    navigate(\"/auths/login\");\r\n    return null;\r\n  }\r\n  return <Component {...rest} />;\r\n};\r\nexport default PrivateRoute;\r\n","import React from \"react\";\r\nimport { Router } from \"@reach/router\";\r\nimport MainLayout from \"../components/main-layout\";\r\nimport Login from \"../components/auths/login/login\";\r\nimport ProjectPage from \"../components/auths/project/project-page\";\r\nimport LoginTemp from \"../components/auths/login/logintemp\";\r\nimport Logout from \"../components/auths/login/logout\";\r\nimport PrivateRoute from \"../components/auths/route/secured-route\";\r\n\r\nconst App = () => (\r\n  <MainLayout>\r\n    <Router basepath=\"/app\">\r\n      <Login path=\"/login\" />\r\n      <LoginTemp path=\"/logintemp\" />\r\n\r\n      <PrivateRoute path=\"/logout\" component={Logout} />\r\n      <PrivateRoute path=\"/project-page\" component={ProjectPage} />\r\n    </Router>\r\n  </MainLayout>\r\n);\r\nexport default App;\r\n"],"sourceRoot":""}